---
id: sp11
title: 의존관계 자동 주입
---

인프런 강의 < [스프링 핵심 원리 - 기본편](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8/dashboard) > 정리

---

## 다양한 의존관계 주입 방법
1. 생성자 주입
2. 수정자 주입(setter)
3. 필드 주입
4. 일반 메서드 주입

### 생성자 주입
#### 특징
- 생성자를 딱 한번 호출하는 것을 보장한다.
- **`불변, 필수`** 의존관계에 사용

```java
@Component
public class OrderServiceImpl implements OrderService{

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
}
```
- 생성자가 호출되면 `@Autowired` 애너테이션을 사용해서 의존 관계를 주입해준다.
- 생성자가 1개만 존재하면 `@Autowired` 생략 가능
- 위에 `final`로 선언된 변수는 값이 있어야 한다는 것을 말한다.

### 수정자 주입
####  특징
- setter라고 불리는 필드의 값을 변경하는 수정자 메서드를 통해서 주입
- 선택, 변경 가능성이 있는 의존관계에 사용

```java
@Component
public class OrderServiceImpl implements OrderService {
    private MemberRepository memberRepository;
    private DiscountPolicy discountPolicy;
    @Autowired
    public void setMemberRepository(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Autowired
    public void setDiscountPolicy(DiscountPolicy discountPolicy) {
        this.discountPolicy = discountPolicy;
    }
}
```

### 필드 주입
#### 특징
- 외부에서 변경이 불가능
- DI 프레임워크 없으면 무용지물

```java
@Component
public class OrderServiceImpl implements OrderService {
    @Autowired
    private MemberRepository memberRepository;
    @Autowired
    private DiscountPolicy discountPolicy;
}
```
### 일반 메서드 주입
#### 특징
- 일반 메서드를 통해서 주입 받을 수 있다.
- 한번에 여러필드 주입 가능
- 일반적으로 사용되지 않는다.

## 옵션 처리
- `@Autowired`는 기본 옵션이 `true` 이므로 자동 주입 대상이 없으면 오류가 발생한다.

#### 처리 방법
```java
public class AutowiredTest {

    @Test
    void AutowiredOption() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestBean.class);
    }

    static class TestBean {

        @Autowired(required = false)
        public void setNoBean1(Member noBean1) {
            System.out.println("noBean1 = " + noBean1);
        }

        @Autowired
        public void setNoBean2(@Nullable Member noBean2) {
            System.out.println("noBean2 = " + noBean2);
        }

        @Autowired
        public void setNoBean3(Optional<Member> noBean3) {
            System.out.println("noBean3 = " + noBean3);
        }
    }
}
```
#### 결과
```
setNoBean2 = null
setNoBean3 = Optional.empty
```
1. `@Autowired(required = false)`: 자동 주입 대상이 없으면 수정자 메서드 자체가 호출 안됨
2. `@Nullable`: 자동 주입할 대상이 없으면 Null 입력
3. `Optional<>`: 자동 주입할 대상이 없으면 `Optioanl.empty`가 입력됨

## 생성자 주입을 선택하자!
#### 불변
- 대부분의 의존관계 주입은 애플리케이션 종료까지 변하면 안된다.
- 수정자 주입은 setXXX 메서드를 위해 public으로 선언해야 한다.
- 생성자 주입은 딱 한번 호출 되므로 변하지 않는다.

### 생성자 주입 vs 수정자 주입
#### 생성자 주입
- 생성자 주입은 주입 데이터를 누락했을 경우 `컴파일 오류`가 발생한다.
- **`final` 키워드를 사용해 값이 설정되지 않는 오류를 컴파일 시점에 막을 수 있다.**
```java
@Component
public class OrderServiceImpl implements OrderService{

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;


    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
}
```
#### 수정자 주입
- 반면에 수정자 주입은 실행은 되지만 `Null Point Exception`이 발생한다.
```java
public class OrderServiceImpl implements OrderService {
    private MemberRepository memberRepository;
    private DiscountPolicy discountPolicy;

    @Autowired
    public void setMemberRepository(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Autowired
    public void setDiscountPolicy(DiscountPolicy discountPolicy) {
        this.discountPolicy = discountPolicy;
    }
}
```

#### 결론
- 생성자 주입 방식은 순수한 자바 언어의 특징을 살릴 수 있다.
- 필수 값이 아닌 경우에 수정자 주입 방식을 선택적으로 도입하여 동시에 사용할 수 있다.
- 필드 주입은 사용하지 말자.

